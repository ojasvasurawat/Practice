<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Notes</title>
    <link href="style.css" rel="stylesheet" />
</head>
<body>
    <h1 id="heading">Daily Notes</h1>
    <div id="alert_box"></div>
    <div id="note_box">
        <div id="notes">
            <div>You'r notes</div>
        </div>
    </div>
    <div id="input_div">
        <input type="text" placeholder="Enter your note" id="note">
        <button onclick="addNote()" id="add_button">Add note</button>
    </div>
    



    <script>

        const now = Date();

        let id = -1;

        window.onload = function(){
            let i = 1;
            // const data = localStorage.getItem(i);
            while(localStorage.getItem(i) !== null){
                const data = localStorage.getItem(i).split(",")
                // console.log(data);


                const parent = document.getElementById("notes");
                const child = document.createElement("div");
                // child.innerText = "hello there";
                child.id = `note${i}`;
                child.className = "all_note"
                child.innerHTML = `<p>${data[0]}</p>
                                    <p>created at: ${data[1].slice(0,15)}</p>
                                    <p>time: ${data[1].slice(16,21)}</p>
                                    <button onclick="deleteNote(${i})" class=" ">delete note</button>`;
                parent.appendChild(child);
                


                i++;
            }
            id = i;
        }
        

        document.getElementById("note").addEventListener("keydown", function(event){
            if(event.key === "Enter"){
                event.preventDefault;

                addNote();
            }
        })

        
        async function addNote(){
            const text_input = document.getElementById("note");
            text = text_input.value;
            console.log(text);
            console.log(text.length);
            if(text.length > 200){
                const alert_box = document.getElementById("alert_box");
                Object.assign(alert_box.style, {
                    border: '2px solid rgb(0, 175, 175)',
                    height: '4vh',
                    width: '25vw',
                    borderRadius: '8px',
                    color: 'red',    
                    fontSize: '2vw',
                    
                });
                alert_box.innerText = "to long text";
                console.log("before");
                await new Promise(resolve => setTimeout(resolve, 3000));
                console.log("after");
                alert_box.innerText = "";
                Object.assign(alert_box.style, {
                    border: '',
                    height: '',
                    width: '',
                    borderRadius: '',
                    color: '',
                    fontSize: ''
                });
            }
            else if(text === ""){
                const alert_box = document.getElementById("alert_box");
                Object.assign(alert_box.style, {
                    border: '2px solid rgb(0, 175, 175)',
                    height: '4vh',
                    width: '25vw',
                    borderRadius: '8px',
                    color: 'red',    
                    fontSize: '2vw',
                    
                });
                alert_box.innerText = "enter something";
                console.log("before");
                await new Promise(resolve => setTimeout(resolve, 3000));
                console.log("after");
                alert_box.innerText = "";
                Object.assign(alert_box.style, {
                    border: '',
                    height: '',
                    width: '',
                    borderRadius: '',
                    color: '',
                    fontSize: ''
                });
            }
            else{
                const parent = document.getElementById("notes");
                const child = document.createElement("div");
                // child.innerText = "hello there";
                child.id = `note${id}`;
                child.className = "all_note"
                child.innerHTML = `<p>${text}</p>
                                    <p>created at: ${now.slice(0,15)}</p>
                                    <p>time: ${now.slice(16,21)}</p>
                                    <button onclick="deleteNote(${id})" class=" ">delete note</button>`;
                parent.appendChild(child);
                localStorage.setItem(id, [text, now]);
                console.log(child.id);
                console.log(now);
                console.log(now.slice(0,15));
                
                id++;
                text_input.value="";
            }
        }

        function deleteNote(id){
            const parent = document.getElementById("notes");
            const child = document.getElementById(`note${id}`);
            parent.removeChild(child);

            let i = 1;
            // const data = localStorage.getItem(i);
            while(localStorage.getItem(i) !== null){
                const data = localStorage.getItem(i).split(",")
                console.log(data);
                if(i === id){
                    localStorage.removeItem(id);
                    // break;
                }
                if(i>id){
                    localStorage.setItem(i-1, localStorage.getItem(i))
                }
                i++;
            }
            localStorage.removeItem(i-1);
        }
    </script>
</body>
</html>